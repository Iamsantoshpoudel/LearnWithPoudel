<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>P2P Call - PoudelX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-md mx-auto bg-white p-6 rounded-2xl shadow-lg space-y-4">
    <h1 class="text-2xl font-bold text-center">PoudelX Video Call</h1>
    
    <div>
      <label class="block font-medium mb-1">Your Peer ID:</label>
      <input id="my-peer-id" type="text" class="w-full px-4 py-2 border rounded" readonly />
    </div>

    <div>
      <label class="block font-medium mb-1">Call Peer ID:</label>
      <input id="remote-peer-id" type="text" class="w-full px-4 py-2 border rounded" placeholder="Enter friend's ID" />
      <button onclick="callPeer()" class="w-full mt-2 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
        Call
      </button>
    </div>

    <div class="grid grid-cols-2 gap-2 mt-4">
      <video id="my-video" autoplay muted class="w-full h-40 bg-black rounded"></video>
      <video id="remote-video" autoplay class="w-full h-40 bg-black rounded"></video>
    </div>
  </div>

  <script>

const myVideo = document.getElementById('my-video');
const remoteVideo = document.getElementById('remote-video');
const myPeerIdInput = document.getElementById('my-peer-id');

let myPeerId = localStorage.getItem('poudelx-peer-id');
if (!myPeerId) {
  myPeerId = 'user-' + Math.floor(Math.random() * 100000);
  localStorage.setItem('poudelx-peer-id', myPeerId);
}
myPeerIdInput.value = myPeerId;

// Create PeerJS instance
const peer = new Peer(myPeerId);

navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
  myVideo.srcObject = stream;

  peer.on('call', call => {
    call.answer(stream);
    call.on('stream', remoteStream => {
      remoteVideo.srcObject = remoteStream;
    });
  });
}).catch(err => {
  alert('Error accessing camera/mic: ' + err.message);
});

function callPeer() {
  const remoteId = document.getElementById('remote-peer-id').value;
  if (!remoteId) return alert('Enter a peer ID to call');
  navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
    const call = peer.call(remoteId, stream);
    call.on('stream', remoteStream => {
      remoteVideo.srcObject = remoteStream;
    });
  });
}
</script>
</body>
</html>